<Window x:Class="PixiEditor.Views.Dialogs.PalettesBrowser"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:PixiEditor.Views.UserControls.Palettes" xmlns:converters="clr-namespace:PixiEditor.Helpers.Converters"
             mc:Ignorable="d" 
             xmlns:gif="http://wpfanimatedgif.codeplex.com" xmlns:usercontrols="clr-namespace:PixiEditor.Views.UserControls" xmlns:views="clr-namespace:PixiEditor.Views"
             xmlns:behaviours="clr-namespace:PixiEditor.Helpers.Behaviours"
             Title="Palettes Browser" WindowStartupLocation="CenterScreen" MinWidth="200" Height="600" Width="825" WindowStyle="None"
             Name="palettesBrowser">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"  GlassFrameThickness="0.1"
                      ResizeBorderThickness="{x:Static SystemParameters.WindowResizeBorderThickness}" />
    </WindowChrome.WindowChrome>

    <Window.CommandBindings>
        <CommandBinding Command="{x:Static SystemCommands.CloseWindowCommand}" CanExecute="CommandBinding_CanExecute"
                        Executed="CommandBinding_Executed_Close" />
    </Window.CommandBindings>

    <Grid Background="{StaticResource AccentColor}" FocusVisualStyle="{x:Null}" Focusable="True" MouseDown="Grid_MouseDown">
        <Grid.RowDefinitions>
            <RowDefinition Height="35" />
            <RowDefinition Height="55"/>
            <RowDefinition Height="1*"/>
            <RowDefinition Height="20"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0" Background="{StaticResource MainColor}">
            <Button DockPanel.Dock="Right" HorizontalAlignment="Right" Style="{StaticResource CloseButtonStyle}"
                    WindowChrome.IsHitTestVisibleInChrome="True" ToolTip="Close"
                    Command="{x:Static SystemCommands.CloseWindowCommand}" />
        </DockPanel>
        <DockPanel Background="{StaticResource MainColor}" Grid.Row="1">
            <StackPanel HorizontalAlignment="Left" Margin="10" Orientation="Horizontal" VerticalAlignment="Center">
                <Label Content="Sort by:" Style="{StaticResource BaseLabel}" VerticalAlignment="Center" FontSize="16"/>
                <ComboBox Name="sortingComboBox" FontSize="16" VerticalAlignment="Center" SelectionChanged="SortingComboBox_SelectionChanged">
                    <ComboBoxItem IsSelected="True">Default</ComboBoxItem>
                    <ComboBoxItem>Alphabetical</ComboBoxItem>
                    <ComboBoxItem>Color Count</ComboBoxItem>
                </ComboBox>
                <ToggleButton Margin="10 0 0 0" Name="toggleBtn"
                              IsChecked="{Binding ElementName=palettesBrowser, Path=SortAscending}"
                              Focusable="False"
                              Style="{StaticResource PixiEditorDockThemeToolButtonStyle}">
                    <Image Width="24" Height="24" Source="/Images/ChevronsDown.png">
                        <Image.Style>
                            <Style TargetType="{x:Type Image}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ElementName=toggleBtn, Path=IsChecked}" Value="true">
                                        <Setter Property="RenderTransform">
                                            <Setter.Value>
                                                <RotateTransform Angle="180" CenterX="11.5" CenterY="11.5"/>
                                            </Setter.Value>
                                        </Setter>
                                        <Setter Property="ToolTip" Value="Ascending"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ElementName=toggleBtn, Path=IsChecked}" Value="false">
                                        <Setter Property="ToolTip" Value="Descending"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Image.Style>
                    </Image>
                </ToggleButton>
                <Label Margin="10 0 0 0" Content="Name:" Style="{StaticResource BaseLabel}" VerticalAlignment="Center" FontSize="16"/>
                <usercontrols:InputBox FontSize="16"
                                       Text="{Binding ElementName=palettesBrowser, Path=NameFilter,
                                       Delay=100, UpdateSourceTrigger=PropertyChanged}"
                                       VerticalAlignment="Center"
                                       Style="{StaticResource DarkTextBoxStyle}" Width="200" />

                <Label Margin="10 0 0 0" Content="Colors:" Style="{StaticResource BaseLabel}" VerticalAlignment="Center" FontSize="16"/>
                <ComboBox Name="colorsComboBox" FontSize="16" VerticalAlignment="Center" SelectionChanged="ColorsComboBox_SelectionChanged">
                    <ComboBoxItem IsSelected="True">Any</ComboBoxItem>
                    <ComboBoxItem>Max</ComboBoxItem>
                    <ComboBoxItem>Min</ComboBoxItem>
                    <ComboBoxItem>Exact</ComboBoxItem>
                </ComboBox>
                <views:NumberInput Width="50" FontSize="16" VerticalAlignment="Center" Margin="10 0 0 0"
                                   FocusNext="True"
                                   Value="{Binding ElementName=palettesBrowser, Path=ColorsNumber, Mode=TwoWay}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0 0 10 0">
                <Button ToolTip="Add from current palette" Click="AddFromPalette_OnClick" Cursor="Hand" Margin="10 0" Style="{StaticResource ImageButtonStyle}" Width="24" Height="24">
                    <Image Source="/Images/Plus-square.png"/>
                </Button>
                <Button Cursor="Hand" Click="OpenFolder_OnClick" Style="{StaticResource ImageButtonStyle}" Width="24" Height="24">
                    <Image Source="/Images/Folder.png"/>
                </Button>
            </StackPanel>
        </DockPanel>
        <Grid Grid.Row="2" Margin="10">
            <TextBlock Text="Couldn't fetch palettes" Foreground="White" FontSize="20" HorizontalAlignment="Center" 
                       VerticalAlignment="Center" Visibility="{Binding ElementName=itemsControl, 
                Path=Visibility, Converter={converters:OppositeVisibilityConverter}}"/>
            <ScrollViewer Name="scrollViewer" Margin="5" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" ScrollChanged="ScrollViewer_ScrollChanged">
                <ItemsControl Name="itemsControl" ItemsSource="{Binding ElementName=palettesBrowser, Path=SortedResults}"
                          Visibility="{Binding ElementName=palettesBrowser, Path=PaletteList.FetchedCorrectly,
                Converter={StaticResource BoolToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <local:PaletteItem Palette="{Binding}"
                                               OnRename="PaletteItem_OnRename"
                                               DeletePaletteCommand="{Binding DeletePaletteCommand, ElementName=palettesBrowser}"
                                               ImportPaletteCommand="{Binding ImportPaletteCommand, ElementName=palettesBrowser}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            <Image gif:ImageBehavior.AnimatedSource="/Images/Processing.gif" HorizontalAlignment="Center" VerticalAlignment="Center"
                   Visibility="{Binding ElementName=palettesBrowser, Path=IsFetching, Converter={StaticResource BoolToVisibilityConverter}}"
                   Height="50" gif:ImageBehavior.AnimationSpeedRatio="1.5"/>
        </Grid>
    </Grid>
</Window>
